<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/funcoes.js"></script>
    <link rel="shortcut icon" href="assets/imgs/Logo.png" type="image" href="style.css">
    <link rel="stylesheet" href="style.css">
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <title>Code Blog</title>
</head>
<body onload="validarSessao()"> 
    <div class="sidebar">
        <div class="logo_content">
            <div class="logo">
                <img src="assets/imgs/Logo.png" alt="">
                <div class="logo_name">
                    Code Blog
                </div>
            </div>
            <i class='bx bx-menu bx-sm' id="btn_menu"></i>
        </div>
        <ul class="nav_list">
            <li>
                <a href="home.html">
                    <i class='bx bx-home-alt-2 bx-sm'></i>
                    <span class="links_name">Home</span>
                </a>
                <span class="tooltip">Home</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-chat bx-sm'></i>
                    <span class="links_name">Fórum</span>
                </a>
                <span class="tooltip">Forum</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-code bx-sm'></i>
                    <span class="links_name">Learn</span>
                </a>
                <span class="tooltip">Learn</span>
            </li>
            <li>
                <a href="profile.html">
                    <i class='bx bx-user bx-sm'></i>
                    <span class="links_name">Account</span>
                </a>
                <span class="tooltip">Account</span>
            </li>
        </ul>
        <div class="profile_content">
            <div class="profile">
                <div class="profile_details">
                    <img src="assets/imgs/Profile.jpg" alt="">
                    <div class="name_job">
                        <div class="name"><span id="b_usuario">Vinicius Cardoso</span></div>
                    </div>
                </div>
                <a onclick="limparSessao()" a="index.html">
                    <i class='bx bx-log-out' id='logout'></i>
                </a>
            </div>
        </div>
    </div>
    <!-- Page content begining  -->
    <div class="home_content">
        <div class="update_picture">
                
            
            <div style="display: flex">
                <img src="assets/imgs/Profile.jpg" alt="">
                
                <div class="change_pictureText">
                    <h1><span id="titulo_usuario">Vinicius Cardoso</span></h1>
                    <h4><span id="ling_preferida"></span></h4>
                </div>
            </div>

            <div>
                <label for="ipt_profileImg" class="upload_img">
                    <input type="file" name="" id="ipt_profileImg">
                    Upload
                </label>
            </div>

                
        </div>
        <div class="user_information">
            <h1>Informações do Usuário</h1>

            <div style="display: flex;">
                <div class="account_info">
                    <h4>Nome:</h4>
                    <input type="text" class="ipt_informations" id="profile_nome" placeholder="">
    
                    <h4>Senha:</h4>
                    <input type="password" class="ipt_informations" placeholder="*******" id="profile_senha">
                </div>
    
                <div class="account_info">
                    <h4>Email:</h4>
                    <input type="text" class="ipt_informations" placeholder="" id="profile_email">
                    
                    <h4>Linguagem preferida:</h4>
                    <input type="text" class="ipt_informations" placeholder="" id="profile_lang">
                    
                </div>

            </div>

            <div class="div_btn_update">
                <button class="btn_update" onclick="atualizar()">Atualizar</button>  
            </div>

            <div id="card_erro">
                <h4 id="mensagem_erro"></h4>
            </div>
            
            
        </div>
    </div>
</body>
<script>
    // script para a barra lateral

    let btn_menu = document.querySelector("#btn_menu");
    let sidebar = document.querySelector(".sidebar");

    btn_menu.onclick = function() {
        sidebar.classList.toggle("active");
    }
</script>

<script>
    function atualizar() {
        var nomeVar = profile_nome.value;
        var emailVar = profile_email.value;
        var senhaVar = profile_senha.value;
        var lingVar = profile_lang.value;
        var idVar = sessionStorage.ID_USUARIO;
        
        fetch("/usuarios/atualizarPerfil", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                linguagemServer: lingVar,
                idUsuarioServer: idVar,
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                card_erro.style.display = "flex";
                mensagem_erro.style.color = "white";
                mensagem_erro.innerHTML = "Alterações realizadas";
                
                sessionStorage.clear();
                
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.idUsuario;
                    sessionStorage.LINGUAGEM_FAVORITA = json.lingPreferida;

                    setTimeout(function () {
                        window.location.reload();
                    }, 2000); 

                });

                limparFormulario();
                
            } else {
                throw ("Houve um erro ao tentar atualizar as informações!");
                cardErro.style.display = "flex";
                mensagem_erro.style.color = "white";
                mensagem_erro.innerHTML = "Houve um erro ao realizar as informações";
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    
</script>